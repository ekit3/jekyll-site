
<!doctype html>
<html>
    <head>
        <meta name="theme-color" content="#000000"/>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Mutation testing</title>
        <link rel="stylesheet" href="/jekyll-site/assets/css/bootstrap.min.css" />
        <link rel="stylesheet" href="/jekyll-site/assets/css/select2.min.css" />
        <link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="Bienvenue sur le Blog d'Ekite" />
        <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet">
        <link rel="stylesheet" href="/jekyll-site/css/main.css" />
        <link rel="icon" href="/jekyll-site/assets/images/favicon.png" href="logo.png" />
        <link rel="manifest" href="/jekyll-site/manifest.webmanifest">
        
            <script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-D332437KRM"
></script>
<script>

    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    var tagAnalyticsCNIL = {};

    tagAnalyticsCNIL.CookieConsent = (function () {
    var gaProperty = "G-D332437KRM";
    // Désactive le tracking si le cookie d’Opt-out existe déjà.
    var disableStr = `ga-disable-${gaProperty}`;
    var firstCall = false;
    var domaineName = "";

    //Cette fonction retourne la date d’expiration du cookie de consentement

    function getCookieExpireDate() {
        var cookieTimeout = 33696000000; // Le nombre de millisecondes que font 13 mois
        var date = new Date();
        date.setTime(date.getTime() + cookieTimeout);
        var expires = "; expires=" + date.toGMTString();
        return expires;
    }

    function getDomainName() {
        if (domaineName != "") {
            return domaineName;
        } else {
            var hostname = document.location.hostname;
            if (hostname.indexOf("www.") === 0) hostname = hostname.substring(4);
            return hostname;
        }
    }

    //Cette fonction définie le périmétre du consentement ou de l'opposition  (en fonction du domaine)
    //Par défaut nous considérons que le domaine est tout ce qu'il y'a aprés  "www"
    function getCookieDomainName() {
        var hostname = getDomainName();
        var domain = "domain=" + "." + hostname;
        return domain;
    }

    //Cette fonction vérifie si on  a déjà obtenu le consentement de la personne qui visite le site
    function checkFirstVisit() {
        var consentCookie = getCookie("hasConsent");
        if (!consentCookie) return true;
    }

    function showBanner() {
        var bodytag = document.getElementsByTagName("body")[0];
        var div = document.createElement("div");
        div.setAttribute('id','cookie-banner');
        div.style.width = window.innerWidth + "px";
        div.style.height = window.innerHeight + "px";
        div.style.position = "fixed";
        div.style.zIndex = "100000";
        div.style.backgroundColor = "#11111190"
        div.innerHTML = `
                <div style="width: 300px; 1px solid #2F343A; border-radius: 5px; background-color: #f1f1f1; repeat scroll 0% 0% white; padding :10px 10px;text-align:center; position: fixed; top:30px; left:50%; margin-top:0px; margin-left:-150px; z-index:100000; id="inform-and-consent">
                    <div>
                        <span><b>Ce site utilise Google Analytics</b></span><br/><br/>
                        En continuant à naviguer, vous nous autorisez à déposer un cookie à des fins de mesure d'audience.
                    </div>
                    <div style="padding :20px;text-align:center;">
                    <button 
                        style="margin-right:50px;"
                        class="btn btn-light"
                        name="Accepter"
                        onclick="tagAnalyticsCNIL.CookieConsent.gaOptout();tagAnalyticsCNIL.CookieConsent.hideInform();"
                        id="optout-button">
                        Refuser
                    </button>
                    <button
                        name="cancel"
                        class="btn btn-success"
                        onclick="tagAnalyticsCNIL.CookieConsent.hideInform()">
                        Accepter
                    </button>
                    </div>
                </div>
            `;
      bodytag.insertBefore(div, bodytag.firstChild);
    }

    // Fonction utile pour récupérer un cookie a partire de son nom
    function getCookie(NameOfCookie) {
        if (document.cookie.length > 0) {
            begin = document.cookie.indexOf(NameOfCookie + "=");
            if (begin != -1) {
            begin += NameOfCookie.length + 1;
            end = document.cookie.indexOf(";", begin);
            if (end == -1) end = document.cookie.length;
            return unescape(document.cookie.substring(begin, end));
            }
        }
        return null;
    }

    //Récupère la version d'Internet Explorer, si c'est un autre navigateur la fonction renvoie -1
    function getInternetExplorerVersion() {
        var rv = -1;
        if (navigator.appName == "Microsoft Internet Explorer") {
            var ua = navigator.userAgent;
            var re = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
            if (re.exec(ua) != null) rv = parseFloat(RegExp.$1);
        } else if (navigator.appName == "Netscape") {
            var ua = navigator.userAgent;
            var re = new RegExp("Trident/.*rv:([0-9]{1,}[\.0-9]{0,})");
            if (re.exec(ua) != null) rv = parseFloat(RegExp.$1);
        }
        return rv;
    }

    //Effectue une demande de confirmation de DNT pour les utilisateurs d'IE
    function askDNTConfirmation() {
        var r = confirm(
            "La signal DoNotTrack de votre navigateur est activé, confirmez vous activer la fonction DoNotTrack?"
        );
        return r;
    }

    //Vérifie la valeur de navigator.DoNotTrack pour savoir si le signal est activé et est à 1
    function notToTrack() {
        if (
            (navigator.doNotTrack &&
            (navigator.doNotTrack == "yes" || navigator.doNotTrack == "1")) ||
            (navigator.msDoNotTrack && navigator.msDoNotTrack == "1")
        ) {
            var isIE = getInternetExplorerVersion() != -1;
            if (!isIE) {
            return true;
            } else {
            return askDNTConfirmation();
            }
            return false;
        }
    }

    //Si le signal est à 0 on considére que le consentement a déjà été obtenu
    function isToTrack() {
      if (
        navigator.doNotTrack &&
        (navigator.doNotTrack == "no" || navigator.doNotTrack == 0)
      ) {
        return true;
      }
    }

    // Fonction d'effacement des cookies
    function delCookie(name) {
      var path = ";path=" + "/";

      var expiration = "Thu, 01-Jan-1970 00:00:01 GMT";
      document.cookie = `${name}=${path} ; ${getCookieDomainName()} ;expires=${expiration}`;
    }

    // Efface tous les types de cookies utilisés par Google Analytics
    function deleteAnalyticsCookies() {
      var cookieNames = ["__utma", "__utmb", "__utmc", "__utmz", "_ga", "_gat"];
      for (var i = 0; i < cookieNames.length; i++) delCookie(cookieNames[i]);
    }

    function isClickOnOptOut(evt) {
      // Si le noeud parent ou le noeud parent du parent est la banniére, on ignore le clic
      return (
        evt.target.parentNode.id == "cookie-banner" ||
        evt.target.parentNode.parentNode.id == "cookie-banner" ||
        evt.target.id == "optout-button"
      );
    }

    function consent(evt) {
      if (!isClickOnOptOut(evt)) {
        // On vérifie qu'il ne s'agit pas d'un clic sur la banniére
        if (!clickprocessed) {
          evt.preventDefault();
          /*document.cookie = `hasConsent=true ${getCookieExpireDate()} ${getCookieDomainName()} path=/`;
          callGoogleAnalytics();*/
          clickprocessed = true;
          window.setTimeout(function () {
            evt.target.click();
          }, 1000);
          tagAnalyticsCNIL.CookieConsent.hideInform();
        }
      }
    }

    // Tag Google Analytics, cette version est avec le tag Universal Analytics
    function callGoogleAnalytics() {
        if (firstCall) return;
        else firstCall = true;

        gtag("js", new Date());
        gtag("config", gaProperty);

        (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
            i[r] ||
            function () {
                (i[r].q = i[r].q || []).push(arguments);
            }),
            (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
        })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
        );
        ga("create", gaProperty, "auto"); // Replace with your property ID.
        ga("send", "pageview", "/articles/testing/mutation-testing/");
    }

    return {
        // La fonction d'opt-out
        gaOptout: function () {
            document.cookie = `${disableStr}=true ${getCookieExpireDate()} ${getCookieDomainName()} path=/`;
            document.cookie = `hasConsent=false ${getCookieExpireDate()} ${getCookieDomainName()} path=/`;
            var div = document.getElementById("cookie-banner");
            // on considère que le site a été visité
            clickprocessed = true;
            // Ci dessous le code de la bannière affichée une fois que l'utilisateur s'est opposé au dépot
            // Vous pouvez modifier le contenu et le style
            if (div != null)
            div.innerHTML =
                '<div style="background-color:#fff;text-align:center;padding:5px;font-size:12px;border-bottom:1px solid #eeeeee;" id="cookie-message"> Vous vous êtes opposé \
                au dépôt de cookies de mesures d\'audience dans votre navigateur </div>';
            window[disableStr] = true;
            deleteAnalyticsCookies();
        },

        hideInform: function () {
            var div = document.getElementById("cookie-banner");
            div.style.display = "none";
        },

        start: function () {
            //Ce bout de code vérifie que le consentement n'a pas déjà été obtenu avant d'afficher
            // la bannière
            var consentCookie = getCookie("hasConsent");
            clickprocessed = false;
            if (!consentCookie) {
            //L'utilisateur n'a pas encore de cookie, on affiche la banniére et si il clique sur un autre élément que la banniére, on enregistre le consentement
            if (notToTrack()) {
                //L'utilisateur a activé DoNotTrack. Do not ask for consent and just opt him out
                tagAnalyticsCNIL.CookieConsent.gaOptout();
            } else {
                if (isToTrack()) {
                //DNT is set to 0, no need to ask for consent just set cookies
                consent();
                } else {
                if (window.addEventListener) {
                    // See note https://github.com/CNILlab/Cookie-consent_Google-Analytics/commit/e323b3be2c4a4d05300e35cdc11102841abdcbc9
                    // Standard browsers
                    window.addEventListener("load", showBanner, false);
                    document.addEventListener("click", consent, false);
                } else {
                    window.attachEvent("onload", showBanner);
                    document.attachEvent("onclick", consent);
                }
                }
            }
            } else {
            if (document.cookie.indexOf("hasConsent=false") > -1)
                window[disableStr] = true;
            else callGoogleAnalytics();
            }
        },
    };
  })();

  tagAnalyticsCNIL.CookieConsent.start();
</script>

        
    </head>
    <body>
        <nav class="header">
    <a class="ekite" href="https://www.ekit3.com/" target="_blank"><img alt="logo Ekite" src="/jekyll-site/assets/images/logo-ekite.png"></a>
    <a class="link" href="/jekyll-site/"><span class="material-icons">roofing</span><span class="a-title">Accueil</span></a>
    <!--<a class="link" href="/jekyll-site/pageTest"><span class="material-icons">star_border</span>Page test</a>-->
    <div class="search">
        <select class="search-article">
            <option></option>
            
                <optgroup label="front-end">
                
                    <option value="/jekyll-site/articles/front-end/pwa-innovation-or-consolation/">PWA : Innovation ou solution de consolation ?</option>
                
            </optgroup>
            
                <optgroup label="testing">
                
                    <option value="/jekyll-site/articles/testing/mutation-testing/">Mutation testing</option>
                
            </optgroup>
            
        </select>
    </div>
</nav>

        <main class="page-content" aria-label="Content">
            
  <div class="posts single">
    <button type="button" class="btn btn-dark btn-return" onclick="goBackHistory()">Retour</button>
    <article>
      <h2>Mutation testing</h2>
      <div class="post-header">
          <span>Ecrit par</span>


    
    
         <a href="">Yoann Bouquet</a>,
    


          <span>Publié le 27 Oct 2021</span>
      </div>
      <div class="extract">
          <span></span><p>Le mutation testing a été inventé en 1971 par Richard Lipton.
Sa réflexion est venue suite à des expériences de projets où les programmeurs devaient consacrer le moins de temps possible aux tests.
Le programmeur devait se contenter de tester intelligemment à moindre coût.
Pour lui, l’avantage des programmeurs est qu’ils créent des programmes qui sont presque corrects.
Les erreurs sont principalement dues à des actions inappropriées ou manquantes dans les spécifications. 
Ces erreurs devraient être détectables comme des déviations du programme prévu d’où le mutation testing.</p>

<p>Cette technique a pour but d’évaluer l’efficacité des tests unitaires des applications.</p>

<p>Son expansion a, en grande partie, été restreinte à cause de la lourdeur du processus,
mais l’augmentation de la puissance des machines permet de rendre le “mutation testing” plus accessible.</p>

<!--END_SUMMARY-->

<h2 id="concept">Concept</h2>

<p>Dans la plupart des projets actuels, les équipes mettent un taux minimal arbitraire de couverture du code à 70 ou 80% (en fonction de la maturité des équipes).</p>

<p>Cet indicateur ne veut pas dire que le code a été testé à 70 ou 80% et même une couverture de code à 100% n’exclut pas de trouver un bug même si cela peut apporter une illusion de sécurité : qui n’a jamais vu un test avec un assert(true).</p>

<p>En parallèle, dans les projets informatiques, plus un bug est découvert tard, plus il coûte cher, le mutation testing peut aider à réduire ces coûts.</p>

<p>Le concept du mutation testing est là pour venir modifier le code “métier” et ainsi vérifier si les tests unitaires arrivent à détecter les changements.</p>

<p>Les objectifs du mutation testing sont multiples :</p>

<ul>
  <li>Identifier des tests qui ne détectent pas les changements</li>
  <li>Avoir un score de mutation</li>
  <li>Apprendre et analyser l’état d’infection d’une application.</li>
</ul>

<h2 id="vocabulaire-du-mutation-testing">Vocabulaire du mutation testing</h2>

<p>Les tests unitaires sont une composante du mutation testing. 
Le test unitaire correspond à la vérification d’un bon comportement d’une petite partie d’une application.</p>

<p>Une mutation est, quant à elle, une modification du code source, comme par exemple, l’action de remplacer un opérateur par un autre, voici quelques exemples :</p>

<ul>
  <li>passer de + à  -</li>
  <li>passer de &gt;= à  ==</li>
  <li>passer de true à false</li>
  <li>supprimer une instruction</li>
</ul>

<p>Un mutant est le code source modifié par une mutation</p>

<h2 id="principe-de-mutation">Principe de mutation</h2>

<p>Le principe de mutation se base sur un code “métier” sur lequel on souhaite tester la pertinence des tests unitaires.</p>

<p>Exemple de mutations possibles et de code métier associés</p>

<ul>
  <li><code class="highlighter-rouge">+</code> → <code class="highlighter-rouge">-</code></li>
  <li><code class="highlighter-rouge">-</code> → <code class="highlighter-rouge">+</code></li>
  <li><code class="highlighter-rouge">!=</code> → <code class="highlighter-rouge">==</code></li>
  <li><code class="highlighter-rouge">=</code> → <code class="highlighter-rouge">!=</code></li>
  <li><code class="highlighter-rouge">==</code> → <code class="highlighter-rouge">&gt;=</code></li>
</ul>

<p>La phase de génération consiste à parcourir le code métier et à déterminer les mutations possibles. Dès qu’une mutation est applicable alors elle générera un nouveau “mutant”.</p>

<p>Le processus de génération des mutants peut être gourmand en ressources car le nombre de mutants peut varier en fonction de la complexité du code métier (il y a quelques années c’était encore un frein à l’utilisation de ce concept). 
Il existe des frameworks permettant de générer des mutants de façon “automatique” tel que Pitest pour Java.</p>

<p>Voici par exemple une simple classe qui réalise une addition:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.business</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Add</span> <span class="o">{</span>
    
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">addNumber</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>Et voici deux mutants possibles:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.business</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AddMutation1</span> <span class="o">{</span>
    
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">addNumber</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.business</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AddMutation2</span> <span class="o">{</span>
    
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">addNumber</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">){</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<h2 id="processus-de-tests">Processus de tests</h2>

<p>En reprenant l’exemple précédent, nous avons une classe qui a pour but de faire l’addition de deux nombres. Pitest a été utilisé pour le projet.
Pour l’exercice, nous allons voir plusieurs cas.</p>

<h3 id="cas-1--absence-de-test-unitaire">Cas 1 : absence de test unitaire</h3>

<p>Le but de ce test est de voir comment le mutation testing peut aider un projet sans test unitaire même si cela peut paraître une hérésie… c’est possible…</p>

<p>Voici le résultat de Pitest sur notre classe :</p>

<p><img src="/jekyll-site/articles/testing/mutation-testing//./pitest-result-no-tests.png" alt="un rapport PiTest en l'absence de tests unitaires" /></p>

<p>Pitest a créé deux mutants (mis en exemple précédemment) qui sont toujours en vie à la fin du test. Voici le détail des mutations qui ont été effectuées :</p>

<p><img src="/jekyll-site/articles/testing/mutation-testing//./pitest-mutations.png" alt="les mutations faites par Pitest sur notre classse" /></p>

<h3 id="cas-2--ajout-dun-test-unitaire">Cas 2 : ajout d’un test unitaire</h3>

<p>Pour l’exemple, nous avons un test unitaire qui ne couvre pas entièrement la méthode testée.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">testAddPositive</span><span class="o">(){</span>
    <span class="nc">Add</span> <span class="n">myAddTest</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Add</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>

    <span class="k">if</span><span class="o">(</span><span class="n">myAddTest</span><span class="o">.</span><span class="na">addNumber</span><span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">){</span>
        <span class="n">fail</span><span class="o">(</span><span class="s">"a et b sont positifs, le résultat attendu devrait être positif"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Le résultat du mutation testing est le suivant :</p>

<p><img src="/jekyll-site/articles/testing/mutation-testing//./pitest-result-first-test.png" alt="le résultat de pitest avec notre premier test" /></p>

<p>Le mutation testing révèle que les tests unitaires ne sont pas suffisamment costaud. Il faut les renforcer.</p>

<p>Le mutant encore debout est :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.business</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AddMutation2</span> <span class="o">{</span>
    
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">addNumber</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">){</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>Pour cela, il faut analyser le rapport que Pitest donne et appliquer un correctif sur le test unitaire pour tuer le mutant au prochain lancement de Pitest.</p>

<h2 id="cas-3--renforcement-du-test-unitaire">Cas 3 : renforcement du test unitaire</h2>

<p>Suite au renfort du test unitaire, Pitest indique que les tests sont bons et que tous les mutants ont été tués.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">testAddResult</span><span class="o">(){</span>
    <span class="nc">Add</span> <span class="n">myAddTest</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Add</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">expectedResult</span> <span class="o">=</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">;</span>

    <span class="k">if</span><span class="o">(</span><span class="n">myAddTest</span><span class="o">.</span><span class="na">addNumber</span><span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">)</span> <span class="o">!=</span> <span class="n">expectedResult</span><span class="o">){</span>
        <span class="n">fail</span><span class="o">(</span><span class="s">"aLe résultat est différent"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><img src="/jekyll-site/articles/testing/mutation-testing//./pitest-result-test-renforce.png" alt="Le résultat de pitest avec le test renforcé" /></p>

<p>Sur un code court et très simple, Pitest a mis moins de 3s (en moyenne) pour générer des mutants et tester ces derniers.
Il a permis de remonter des faiblesses dans les tests unitaires.
Le travail d’analyse sur les mutants encore en vie est assez simple pour ce cas.</p>

<p>Afin de connaître les limites du mutation testing nous allons l’utiliser sur du code plus complexe.</p>

<p>Schéma d’explication du framework :</p>

<p><img src="/jekyll-site/articles/testing/mutation-testing//./fonctionnement-fwk.jpg" alt="Le fonctionnement du framework" /></p>

<h2 id="exemple-avec-le-périmètre-dun-rectangle">Exemple avec le périmètre d’un rectangle</h2>

<p>Le but de ce programme est de calculer l’aire d’un rectangle.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">RectangleArea</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">calcRectangleArea</span><span class="o">(</span><span class="kt">int</span> <span class="n">length</span><span class="o">,</span> <span class="kt">int</span> <span class="n">width</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">length</span> <span class="o">*</span> <span class="n">width</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>On peut vérifier avec un test si l’aire du rectangle n’est pas égale à 0.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testRectangleArea</span><span class="o">(){</span>
    <span class="nc">RectangleArea</span> <span class="n">area</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RectangleArea</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span> <span class="n">area</span><span class="o">.</span><span class="na">calcRectangleeArea</span><span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">){</span>
        <span class="n">fail</span><span class="o">(</span><span class="s">"L'aire doit être supérieure à 0"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>On pourrait ajouter une règle de gestion à notre premier code, avec une interprétation supplémentaire : “Un carré n’est pas un rectangle”.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">RectangleArea</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">calcRectangleArea</span><span class="o">(</span><span class="kt">int</span> <span class="n">length</span><span class="o">,</span> <span class="kt">int</span> <span class="n">width</span><span class="o">){</span>
        <span class="k">if</span><span class="o">(</span><span class="n">length</span> <span class="o">!=</span> <span class="n">width</span><span class="o">){</span>
            <span class="k">return</span> <span class="n">length</span> <span class="o">*</span> <span class="n">width</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">// on retourne 0 pour les carrés</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Suite au changement de code un test est ajouté afin de tester un carré dont les côtés valent 0.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSquareArea</span><span class="o">(){</span>
    <span class="nc">RectangleArea</span> <span class="n">area</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RectangleArea</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span> <span class="n">area</span><span class="o">.</span><span class="na">calcRectangleeArea</span><span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">){</span>
        <span class="n">fail</span><span class="o">(</span><span class="s">"0 attendu, car nous sommes dans un carré"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Dans les deux cas, Pitest remonte une couverture sur le mutation testing de 0%.</p>

<p><img src="/jekyll-site/articles/testing/mutation-testing//./pitest-result-square.png" alt="Résultat de Pitest" />
<img src="/jekyll-site/articles/testing/mutation-testing//./pitest-result-square-detailed.png" alt="Résultat Pitest détailllé" /></p>

<p>Voici les mutants survivants créés par Pitest. 
Il faut donc analyser les problèmes et renforcer les tests unitaires. 
L’analyse en fonction des résultats peut prendre du temps.</p>

<h2 id="exemple-avec-une-application-plus-complexe">Exemple avec une application plus complexe</h2>

<h3 id="spring-petclinic">Spring PetClinic</h3>

<p>Spring PetClinic est une application exemple proposée par Spring. Elle montre les principales fonctionnalités du framework. C’est une application simple qui compte environ 250 lignes de code.</p>

<p>Elle propose des tests JUnit 5 avec quelques tests unitaires mais surtout des tests d’intégration, dont certains avec des mocks. Au total une quarantaine de tests et une couverture de 93%</p>

<p>L’exécution de l’ensemble des tests prend environ dix secondes dans un IDE.
La commande <code class="highlighter-rouge">mvn test</code> s’exécute approximativement en 20 secondes.</p>

<p>On peut exécuter pitest sur un projet Maven en tapant directement la commande : <code class="highlighter-rouge">mvn org.pitest:pitest-maven:mutationCoverage</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>================================================================================
- Statistics
================================================================================
&gt;&gt; Line Coverage: 222/238 (93%)
&gt;&gt; Generated 111 mutations Killed 74 (67%)
&gt;&gt; Mutations with no coverage 8. Test strength 72%
&gt;&gt; Ran 235 tests (2.12 tests per mutation)
</code></pre></div></div>

<p>Le temps d’exécution est d’un peu plus de 2 minutes.</p>

<h2 id="quels-indicateurs-fournit-le-mutation-testing-">Quels indicateurs fournit le mutation testing ?</h2>

<p>Pitest calcule un taux de force des tests (Test strength) par rapport au mutation testing.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt; Mutations with no coverage 8. Test strength 72%
</code></pre></div></div>

<p>Ce taux peut être utilisé avec le % de couverture de code dans les équipes comme indicateur de qualité sur les premiers niveaux de tests.</p>

<h2 id="implémentations-possibles-sur-différents-langages">Implémentations possibles sur différents langages</h2>

<p>Il existe différents outils pour faire du mutation testing selon les langages :</p>

<p>Java → Pitest</p>

<p>Kotlin → Pitest</p>

<p>Scala → Stryker</p>

<p>PHP → Infection</p>

<p>JS → Stryker</p>

<p>TypeScript → Stryker</p>

<p>Python → MutPy</p>

<h2 id="où-situer-le-mutation-testing-dans-les-méthodes-bdd-et-tdd-">Où situer le mutation testing dans les méthodes BDD et TDD ?</h2>

<p>Le Mutation testing est un complément à ces méthodes, il permet de couvrir l’ensemble des tests unitaires et du code en apportant des modifications.</p>

<p>Le TDD aide à garder le code modulaire cependant il ne suffit pas à fournir un code qui fonctionne exactement comme prévu car il est toujours possible d’ajouter du code à une partie de l’application sans en décrire les attentes. Ceci peut mettre en danger l’ensemble du code. Le mutation testing permet de détecter de façon régulière les possibles “brèches” dans le développement.</p>

<p>Le BDD, quant à lui, est là pour décrire le comportement que doit avoir une application. Le mutation testing lui va s’assurer du bon fonctionnement d’une fonction et non du comportement global.</p>

<h2 id="limites-sur-le-mutation-testing">Limites sur le mutation testing</h2>

<p>L’une des premières limites du mutation testing portait sur l’impact qu’il avait sur les ressources d’un ordinateur (CPU/RAM). Cette limite est de moins en moins vrai aujourd’hui.</p>

<p>La seconde limite reste le temps d’analyse qu’il y a après un rapport de test de mutation testing. Il faut analyser le rapport, puis corriger le test unitaire et ensuite relancer le test de mutation.
Dans cette analyse on peut se retrouver avec des faux positifs ce qui peut constituer une “perte de temps”.</p>

<p>La troisième limite est une tendance de plus en plus présente de nos jours : celle du Green IT.
Le Green IT est une démarche d’amélioration continue qui vise à réduire l’empreinte écologique, économique et sociale des technologies de l’information et de la communication et de l’organisation grâce aux outils numériques. Le mutation testing est très gourmand en termes de ressources CPU et RAM vu qu’il lit le projet, crée des mutants à partir du code source, recompile et rejoue les tests autant de fois qu’il y a de mutants disponibles.</p>

<p>En conclusion, le mutation testing est un outil qui aide les équipes à améliorer la qualité de leurs tests unitaires. Cependant cette méthode peut se révéler très coûteuse si on souhaite une couverture à 100%. 
Il faut prendre en compte le temps d’analyse du rapport et du code à la génération des mutants et à l’exécution des tests pour chaque mutant. 
Cet outil doit être utilisé dans des équipes qui sont déjà “matures” sur la qualité de leur tests. Il peut aider les nouveaux développeurs à structurer leur façon de construire les TU.
De plus, il est possible d’utiliser cet outil pour cibler uniquement des parties bien précises de l’application, notamment les parties les plus sensibles, cela peut être un bon moyen de réduire les coûts et de se concentrer sur le plus critique.</p>

<h2 id="quelques-axes-de-réflexion-pour-aller-plus-loin-sur-ce-sujet">Quelques axes de réflexion pour aller plus loin sur ce sujet</h2>
<p>Comment intégrer le mutation testing dans une stratégie de test ?
Comment automatiser les tests de mutation testing avec github lors d’une peer review par exemple ?
Peut-on automatiser la lecture des rapports et en ressortir les problèmes les plus critiques ?</p>

<h2 id="ressources--bibliographie-">Ressources / Bibliographie :</h2>

<ul>
  <li>Papier de Google : <a href="https://research.google/pubs/pub46584/">State of Mutation Testing at Google (PDF)</a>. Ce papier décrit comment Google utilise les tests de mutation dans le process de code review, pour maximiser la pertinence des mutants :
    <ul>
      <li>une mutation max par ligne de code étudiée (pour limiter la complexité de la review)</li>
      <li>le code “aride” n’est pas muté (caches, System.out.println, code de logging =&gt; if debug, log.debug() ))</li>
      <li>les mutations qui rendraient le code équivalent (supprimer un cache/memoization, for i &lt; 10 ou for i != 10) ne sont pas testées</li>
      <li>ils ne testent pas non plus les mutations sur le code qui pourrait être généré (equals/hashCode/toString) et les messages d’exceptions</li>
    </ul>
  </li>
  <li>
    <p><a href="https://blog.pitest.org/">Blog de PiTest</a></p>
  </li>
  <li>
    <p><a href="https://pitest.org/">Site de PiTest</a></p>
  </li>
  <li>
    <p><a href="https://github.com/theofidry/awesome-mutation-testing">awesome mutation testing</a> : Une compilation des meilleures ressources sur le mutation testing</p>
  </li>
  <li>Hints on Test Data Selection: Help for the Practicing Programmer, de Richard A. Demillo et R.J Lipton</li>
</ul>

</span>
      </div>
    </article>
  </div>

            <footer class="footer">
    <div class="footer-content">
        <h4>Qui sommes nous :</h4>
        <p>"Nos experts vous accompagnent sur la réalisation et l’amélioration de vos systèmes d’information tout en étant en immersion dans vos équipes."</p>
    </div>
    <div class="footer-content">
        <h4>La plus-value proposée :</h4>
        <p>
            vous permettre de prendre du recul sur l’utilisation technologique afin qu’elle soit adaptée à votre contexte.
        </p>
    </div>
    <div class="footer-content">
        <h4>Nous suivre :</h4>
        <div class="social">
            <a href="https://www.linkedin.com/company/ekite/" target="_blank"><img alt="linkedin" src="/jekyll-site/assets/images/logo-linkedin.png"></a>
            <a href="https://twitter.com/Ekite_" target="_blank"><img alt="Twitter" src="/jekyll-site/assets/images/logo-twitter.png"></a>
            <a href="https://github.com/ekit3" target="_blank"><img alt="Github" src="/jekyll-site/assets/images/logo-github.png"></a>
        </div>
    </div>
</footer>
 <div class="copyright">
    <span>Ekite © Copyright 2021. Tous droits réservés</span>
    <a href="/jekyll-site/mentions">Mentions légales</a>
    <a href="https://github.com/Ekawa-fr" target="_blank">Réalisé par Ekawa</a>
</div>

        </main>
        <script src="/jekyll-site/assets/libs/jquery-3.5.1.min.js"></script>
        <script src="/jekyll-site/scripts/index.js"></script>
        <script src="/jekyll-site/assets/libs/bootstrap.bundle.min.js"></script>
        <script src="/jekyll-site/assets/libs/select2.full.min.js"></script>
        <script>
            if (window.Worker) {
                navigator.serviceWorker.register('/jekyll-site/worker.js').then(function(registration) {
                    // console.log('ServiceWorker registration successful with scope:',  registration.scope);
                }).catch(function(error) {
                    console.warn('ServiceWorker registration failed:', error);
                });
            }
        </script>
    </body>
</html>
