
<!doctype html>
<html>
    <head>
        <meta name="theme-color" content="#000000"/>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Abstract Data Types</title>
        <link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
        <link rel="stylesheet" href="/assets/css/select2.min.css" />
        <link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="Bienvenue sur le Blog d'Ekite" />
        <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet">
        <link rel="stylesheet" href="/css/main.css" />
        <link rel="icon" href="/assets/images/favicon.png" href="logo.png" />
        <link rel="manifest" href="/manifest.webmanifest">
        
            <script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-D332437KRM"
></script>
<script>

    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    var tagAnalyticsCNIL = {};

    tagAnalyticsCNIL.CookieConsent = (function () {
    var gaProperty = "G-D332437KRM";
    // Désactive le tracking si le cookie d’Opt-out existe déjà.
    var disableStr = `ga-disable-${gaProperty}`;
    var firstCall = false;
    var domaineName = "";

    //Cette fonction retourne la date d’expiration du cookie de consentement

    function getCookieExpireDate() {
        var cookieTimeout = 33696000000; // Le nombre de millisecondes que font 13 mois
        var date = new Date();
        date.setTime(date.getTime() + cookieTimeout);
        var expires = "; expires=" + date.toGMTString();
        return expires;
    }

    function getDomainName() {
        if (domaineName != "") {
            return domaineName;
        } else {
            var hostname = document.location.hostname;
            if (hostname.indexOf("www.") === 0) hostname = hostname.substring(4);
            return hostname;
        }
    }

    //Cette fonction définie le périmétre du consentement ou de l'opposition  (en fonction du domaine)
    //Par défaut nous considérons que le domaine est tout ce qu'il y'a aprés  "www"
    function getCookieDomainName() {
        var hostname = getDomainName();
        var domain = "domain=" + "." + hostname;
        return domain;
    }

    //Cette fonction vérifie si on  a déjà obtenu le consentement de la personne qui visite le site
    function checkFirstVisit() {
        var consentCookie = getCookie("hasConsent");
        if (!consentCookie) return true;
    }

    function showBanner() {
        var bodytag = document.getElementsByTagName("body")[0];
        var div = document.createElement("div");
        div.setAttribute('id','cookie-banner');
        div.style.width = window.innerWidth + "px";
        div.style.height = window.innerHeight + "px";
        div.style.position = "fixed";
        div.style.zIndex = "100000";
        div.style.backgroundColor = "#11111190"
        div.innerHTML = `
                <div style="width: 300px; 1px solid #2F343A; border-radius: 5px; background-color: #f1f1f1; repeat scroll 0% 0% white; padding :10px 10px;text-align:center; position: fixed; top:30px; left:50%; margin-top:0px; margin-left:-150px; z-index:100000; id="inform-and-consent">
                    <div>
                        <span><b>Ce site utilise Google Analytics</b></span><br/><br/>
                        En continuant à naviguer, vous nous autorisez à déposer un cookie à des fins de mesure d'audience.
                    </div>
                    <div style="padding :20px;text-align:center;">
                    <button 
                        style="margin-right:50px;"
                        class="btn btn-light"
                        name="Refuser"
                        onclick="tagAnalyticsCNIL.CookieConsent.gaOptout();tagAnalyticsCNIL.CookieConsent.hideInform();"
                        id="optout-button">
                        Refuser
                    </button>
                    <button
                        id="accept-ga"
                        name="Valider"
                        class="btn btn-success"
                        onclick="tagAnalyticsCNIL.CookieConsent.hideInform()">
                        Accepter
                    </button>
                    </div>
                </div>
            `;
      bodytag.insertBefore(div, bodytag.firstChild);
    }

    // Fonction utile pour récupérer un cookie a partire de son nom
    function getCookie(NameOfCookie) {
        if (document.cookie.length > 0) {
            begin = document.cookie.indexOf(NameOfCookie + "=");
            if (begin != -1) {
            begin += NameOfCookie.length + 1;
            end = document.cookie.indexOf(";", begin);
            if (end == -1) end = document.cookie.length;
            return unescape(document.cookie.substring(begin, end));
            }
        }
        return null;
    }

    //Récupère la version d'Internet Explorer, si c'est un autre navigateur la fonction renvoie -1
    function getInternetExplorerVersion() {
        var rv = -1;
        if (navigator.appName == "Microsoft Internet Explorer") {
            var ua = navigator.userAgent;
            var re = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
            if (re.exec(ua) != null) rv = parseFloat(RegExp.$1);
        } else if (navigator.appName == "Netscape") {
            var ua = navigator.userAgent;
            var re = new RegExp("Trident/.*rv:([0-9]{1,}[\.0-9]{0,})");
            if (re.exec(ua) != null) rv = parseFloat(RegExp.$1);
        }
        return rv;
    }

    //Effectue une demande de confirmation de DNT pour les utilisateurs d'IE
    function askDNTConfirmation() {
        var r = confirm(
            "La signal DoNotTrack de votre navigateur est activé, confirmez vous activer la fonction DoNotTrack?"
        );
        return r;
    }

    //Vérifie la valeur de navigator.DoNotTrack pour savoir si le signal est activé et est à 1
    function notToTrack() {
        if (
            (navigator.doNotTrack &&
            (navigator.doNotTrack == "yes" || navigator.doNotTrack == "1")) ||
            (navigator.msDoNotTrack && navigator.msDoNotTrack == "1")
        ) {
            var isIE = getInternetExplorerVersion() != -1;
            if (!isIE) {
            return true;
            } else {
            return askDNTConfirmation();
            }
            return false;
        }
    }

    //Si le signal est à 0 on considére que le consentement a déjà été obtenu
    function isToTrack() {
      if (
        navigator.doNotTrack &&
        (navigator.doNotTrack == "no" || navigator.doNotTrack == 0)
      ) {
        return true;
      }
    }

    // Fonction d'effacement des cookies
    function delCookie(name) {
      var path = ";path=" + "/";

      var expiration = "Thu, 01-Jan-1970 00:00:01 GMT";
      document.cookie = `${name}=${path} ; ${getCookieDomainName()} ;expires=${expiration}`;
    }

    // Efface tous les types de cookies utilisés par Google Analytics
    function deleteAnalyticsCookies() {
      var cookieNames = ["__utma", "__utmb", "__utmc", "__utmz", "_ga", "_gat"];
      for (var i = 0; i < cookieNames.length; i++) delCookie(cookieNames[i]);
    }

    function isClickOnOptOut(evt) {
      // Si le noeud parent ou le noeud parent du parent est la banniére, on ignore le clic
      return (
        evt.target.parentNode.id == "cookie-banner" ||
        evt.target.parentNode.parentNode.id == "cookie-banner" ||
        evt.target.id == "optout-button"
      );
    }

    function consent(evt) {
      if (!isClickOnOptOut(evt)) {
        // On vérifie qu'il ne s'agit pas d'un clic sur la banniére
        if (!clickprocessed) {
         evt.preventDefault();
         closeModalAfterClickProcessed();
        }
      }
      if(evt.target.id === 'accept-ga'){
        evt.preventDefault();
          document.cookie = `hasConsent=true ${getCookieExpireDate()} ${getCookieDomainName()} path=/`;
          callGoogleAnalytics();
          closeModalAfterClickProcessed();
        }
    }

    function closeModalAfterClickProcessed(){
        clickprocessed = true;
        window.setTimeout(function () {
        evt.target.click();
        }, 1000);
        tagAnalyticsCNIL.CookieConsent.hideInform();
    }

    // Tag Google Analytics, cette version est avec le tag Universal Analytics
    function callGoogleAnalytics() {
        if (firstCall) return;
        else firstCall = true;

        gtag("js", new Date());
        gtag("config", gaProperty);

        (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
            i[r] ||
            function () {
                (i[r].q = i[r].q || []).push(arguments);
            }),
            (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
        })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
        );
        ga("create", gaProperty, "auto"); // Replace with your property ID.
        ga("send", "pageview", "/articles/common/abstract-data-types/");
    }

    return {
        // La fonction d'opt-out
        gaOptout: function () {
            document.cookie = `${disableStr}=true ${getCookieExpireDate()} ${getCookieDomainName()} path=/`;
            document.cookie = `hasConsent=false ${getCookieExpireDate()} ${getCookieDomainName()} path=/`;
            var div = document.getElementById("cookie-banner");
            // on considère que le site a été visité
            clickprocessed = true;
            // Ci dessous le code de la bannière affichée une fois que l'utilisateur s'est opposé au dépot
            // Vous pouvez modifier le contenu et le style
            if (div != null)
            div.innerHTML =
                '<div style="background-color:#fff;text-align:center;padding:5px;font-size:12px;border-bottom:1px solid #eeeeee;" id="cookie-message"> Vous vous êtes opposé \
                au dépôt de cookies de mesures d\'audience dans votre navigateur </div>';
            window[disableStr] = true;
            deleteAnalyticsCookies();
        },

        hideInform: function () {
            var div = document.getElementById("cookie-banner");
            div.style.display = "none";
        },

        start: function () {
            //Ce bout de code vérifie que le consentement n'a pas déjà été obtenu avant d'afficher
            // la bannière
            var consentCookie = getCookie("hasConsent");
            clickprocessed = false;
            if (!consentCookie) {
            //L'utilisateur n'a pas encore de cookie, on affiche la banniére et si il clique sur un autre élément que la banniére, on enregistre le consentement
            if (notToTrack()) {
                //L'utilisateur a activé DoNotTrack. Do not ask for consent and just opt him out
                tagAnalyticsCNIL.CookieConsent.gaOptout();
            } else {
                if (isToTrack()) {
                //DNT is set to 0, no need to ask for consent just set cookies
                consent();
                } else {
                if (window.addEventListener) {
                    // See note https://github.com/CNILlab/Cookie-consent_Google-Analytics/commit/e323b3be2c4a4d05300e35cdc11102841abdcbc9
                    // Standard browsers
                    window.addEventListener("load", showBanner, false);
                    document.addEventListener("click", consent, false);
                } else {
                    window.attachEvent("onload", showBanner);
                    document.attachEvent("onclick", consent);
                }
                }
            }
            } else {
            if (document.cookie.indexOf("hasConsent=false") > -1)
                window[disableStr] = true;
            else callGoogleAnalytics();
            }
        },
    };
  })();

  tagAnalyticsCNIL.CookieConsent.start();
</script>

        
    </head>
    <body>
        <nav class="header">
    <a class="ekite" href="https://www.ekit3.com/" target="_blank"><img alt="logo Ekite" src="/assets/images/logo-ekite.png"></a>
    <a class="link" href="/"><span class="material-icons">roofing</span><span class="a-title">Accueil</span></a>
    <!--<a class="link" href="/pageTest"><span class="material-icons">star_border</span>Page test</a>-->
    <div class="search">
        <select class="search-article">
            <option></option>
            
                <optgroup label="Front-End">
                
                    <option value="/articles/front-end/web-assembly/">Web Assembly</option>
                
                    <option value="/articles/front-end/algebraic-structure/">Les structures algébriques</option>
                
                    <option value="/articles/front-end/micro-front-end/">Micro Front End</option>
                
                    <option value="/articles/front-end/pwa-innovation-or-consolation/">PWA : Innovation ou solution de consolation ?</option>
                
            </optgroup>
            
                <optgroup label="Testing">
                
                    <option value="/articles/testing/mutation-testing/">Mutation testing</option>
                
            </optgroup>
            
                <optgroup label="Green-IT">
                
                    <option value="/articles/green-it/eco-conception/">Eco Conception</option>
                
            </optgroup>
            
                <optgroup label="Other">
                
                    <option value="/articles/other/design-pattern/">Design Pattern</option>
                
            </optgroup>
            
                <optgroup label="Devops">
                
                    <option value="/articles/devops/direnv-pour-votre-shell/">direnv pour booster votre shell</option>
                
                    <option value="/articles/devops/skaffold-et-minikube/">Exécuter une application localement sur minikube avec skaffold</option>
                
            </optgroup>
            
                <optgroup label="Common">
                
                    <option value="/articles/common/mkdocs-material/">Créer un site web de documentation statique avec MkDocs</option>
                
                    <option value="/articles/common/abstract-data-types/">Abstract Data Types</option>
                
            </optgroup>
            
                <optgroup label="Architecture">
                
                    <option value="/articles/architecture/feature-flipping/">Feature Flipping</option>
                
                    <option value="/articles/architecture/kafka/">Kafka</option>
                
            </optgroup>
            
        </select>
    </div>
</nav>

        <main class="page-content" aria-label="Content">
            
  <div class="posts single">
    <button type="button" class="btn btn-dark btn-return" onclick="goBackHistory()">Retour</button>
    <article>
      <h2>Abstract Data Types</h2>
      <div class="post-header">
          <span>Ecrit par</span>


    
    
         <a href="">Florian Barbet</a>,
    


          <span>Publié le 15 Mar 2023</span>
      </div>
      <div class="extract">
          <span></span><h5 id="les-types-abstraits-ou-pourquoi-vous-devez-utiliser-optional">Les types abstraits, ou pourquoi vous devez utiliser Optional</h5>

<p>En tant que développeur, nous cherchons souvent des moyens d’améliorer nos applications. Les rendre plus robustes, plus normées, ou encore anéantir les potentiels effets de bord. La montée des langages fonctionnels a pu faire réapparaître certains concepts mathématiques pour améliorer tout ça.
C’est le cas des types abstraits (en anglais, abstract data type ou ADT). Au-delà des gains cités, certains ADT permettent d’améliorer la gestion de certains langages.<br /></p>

<p><img src="/articles/common/abstract-data-types//henry_1.png" alt="image" /><br /></p>

<p>L’illustre Henri, qui aime tant les mathématiques, semble être très intéressé par le sujet, mais surtout parce qu’il existe un ADT pour optimiser <a href="https://ekite.tech/articles/front-end/algebraic-structure/">son application du plus fort cailloux</a>. Cela permettra d’illustrer les explications qui suivent.
<!--END_SUMMARY--></p>

<h5 id="définitions">Définitions</h5>

<p>Pour créer un type de donnée il faut réunir un ensemble de valeurs et des opérations à appliquer sur cet ensemble. On peut prendre exemple sur les nombres entiers (int, integer).
Il est possible d’appliquer une multitude d’opérations sur les entiers : additions, soustractions, multiplications, etc.</p>

<p>Une des analogies les plus reprises en informatique des types de données sont les primitives, comme les entiers, les booléens, ou les float par exemple.
N.B : Les types primitifs sont nativement gérés par le langage, qui stocke directement les valeurs des variables en mémoire, parfois dans une zone mémoire dédiée (la stack).</p>

<p>L’évolution d’un type de donnée, ce sont les types de données définis par utilisateur. Pour vulgariser il s’agit d’une structure nommée et composée de type de données. Il est possible de les représenter par des structures, des énumérations ou encore des unions. Pour illustrer la représentation d’un point est un type de données définies par utilisateur : Point(int x, int y).</p>

<p>Les types de données défini par utilisateur ne sont pas définis par la machine contrairement aux primitives. Les opérations sous-jacentes de ce type de données sont elles aussi définies par l’utilisateur (le développeur).</p>

<p>Un type abstrait peut être représenté comme le moule d’un type de données définis par utilisateur à la différence près que ce type doit amener une certaine robustesse dans l’écriture de types. 
Ce type de données doit répondre à trois contraintes pour subsister dans un système de type. Il doit être capable de définir des types sommes, produits et récursifs.</p>

<h5 id="pré-requis-du-système-de-type-pour-faire-des-adt">Pré-requis du système de type pour faire des ADT</h5>

<p>1 - Le type somme (tagged-union, variant) c’est la capacité de définir un type pouvant se définir par un sous-ensemble fini de types. En Java cela correspond aux sealed-interface, en OCaml ce sont les variants, en Rust les enum.
Exemple en OCaml :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> type month_type = 
  | PLEIN 
  | CREUX 
  | BIS of int
</code></pre></div></div>

<p>2 - Le type produit (record) correspond à la capacité de créer des structures dans un langage. En Java, on peut créer des objets ou des records, en Rust ou en C on peut créer des structures (struct).</p>

<p>3 - Le type récursif correspond à la capacité pour un type de s’appeler lui-même. 
Exemple avec les variants :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> type List = 
  | Item of int * List
  | Empty

Item (1, Item (2, Item ( 3, Empty)))
</code></pre></div></div>

<p>Voici une liste de quelques langages permettant de faire des ADT :</p>
<ul>
  <li>Caml</li>
  <li>Rust</li>
  <li>Haskell</li>
  <li>Java 17+</li>
  <li>Typescript</li>
  <li>Python</li>
  <li>Scala</li>
  <li>Kotlin</li>
</ul>

<h5 id="cas-dutilisations">Cas d’utilisations</h5>

<p>Les types de données abstraits permettent d’acquérir de la robustesse applicative ET conceptuelle. Cela permet également de pouvoir créer des <a href="https://ekite.tech/articles/other/design-pattern/">design pattern</a> purs et de simplifier la mise en place de machine à état.
Enfin les ADT permettent de rapprocher les données d’un programme lié aux <a href="https://ekite.tech/articles/front-end/algebraic-structure/">structures algébriques</a>.</p>

<p>Voici une liste de quelques types abstraits connus, liés aux structures algébriques:</p>
<ul>
  <li>La présence de valeur (Option)</li>
  <li>La réussite d’un programme (Try)</li>
  <li>La réussite ou l’erreur d’un programme (Result)</li>
  <li>La possibilité d’afficher une donnée (Show)</li>
</ul>

<p>Henri a préparé quelques cartes que vous pourrez trouver <a href="https://docs.google.com/presentation/u/0/d/1P06bSfyXNix0k740iRl1LyyqNyRibcAOsTWn9lomjUo/edit">ici</a> !</p>

<h5 id="la-parole-à-henri">La parole à Henri</h5>

<p>Henri nous rappelle que son application a été codée en Java 17.
La gestion d’erreur dans certains langages peut-être très gourmande en termes de ressources. Ce <a href="https://www.infoworld.com/article/2076868/how-the-java-virtual-machine-handles-exceptions.html">lien</a> explique en détails le bytecode derrière un try-catch. Pour résumer, lorsqu’une exception survient il faut pouvoir dire à la machine de revenir en arrière et exécuter le code dans la partie “catch”.
Plusieurs années se sont écoulées depuis et Henri trouve que son application est obsolète
Il demande à son ami de faire évoluer son application, mais se retrouve depuis quelques temps confronté à une multitude de problème qu’il ne comprend pas :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    java.lang.IllegalArgumentException: D20160229 is not a Caillou
</code></pre></div></div>

<p><img src="/articles/common/abstract-data-types//henry_2.png" alt="image" /></p>

<p>Henri est venu nous voir en nous expliquant qu’il a ce problème à chaque fois qu’il enregistre un de ses cailloux un 29 février. Cela fait déjà 6 ans qu’Henri n’arrive pas à enregistrer son caillou préféré.
Prenons notes de l’existant :</p>
<ul>
  <li>Les fonctionnalités sont rétro-compatibles avec l’ancien modèle.</li>
  <li>La structure de données d’un caillou a changé comme suit :
    <ul>
      <li>Un caractère et 8 chiffres.
Nous décidons de corriger l’ensemble tel qu’il soit constitué d’un caractère et d’une date au format yyyyMMdd. (Cela corrigera en parti les problèmes de la nouvelle application d’Henri)
Nous ne pouvons donc plus nous fier à l’ensemble CPH (Cailloux Potentiels d’Henri), nous sommes sur un ensemble différent que nous nommerons NCPH (Nouveaux Cailloux Potentiels d’Henri) .
Notons que cet ensemble est composé de l’ensemble CPH et de toute chaîne de caractères avec les caractéristiques susmentionnées (nommons cet ensemble CPGH pour Cailloux Potentiels du Grand Henri). On obtient donc CPGH = CPH + NPCH.</li>
    </ul>
  </li>
</ul>

<p><img src="/articles/common/abstract-data-types//henry_3.png" alt="image" /> <br /></p>

<p>Malgré notre précédente correction Henri nous a remonté qu’il subsiste quelques lenteurs et nous fait part de ses besoins :<br />
1 - Il veut pouvoir basculer sur son ancien modèle à tout moment.<br />
2 - Faire en sorte que son application ne subisse plus de lenteurs / erreurs incompréhensibles.<br />
Pour le premier point nous verrons une prochaine fois l’application de la théorie des catégories (plus particulièrement la flèche).
Pour le second ça tombe bien, car nous avons investigué et sommes tombé sur quelques imbrications de try-catch dignes d’une <a href="https://en.wikipedia.org/wiki/Defensive_programming">bonne programmation défensive</a>. Cela s’explique par le fait de devoir convertir les éléments de CPH vers CPGH.
/!\ N’oublions pas qu’Henri procède à des millions d’enregistrements de cailloux par jour.</p>

<p>La solution au problème <img src="/articles/common/abstract-data-types//henry_4.png" alt="image" /> <br /></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="nc">Result</span><span class="o">&lt;</span><span class="nc">Caillou</span><span class="o">,</span> <span class="nc">Exception</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">){</span>
    <span class="kt">var</span> <span class="n">letter</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="k">if</span><span class="o">(</span><span class="n">letter</span> <span class="o">&lt;</span> <span class="mi">65</span> <span class="o">||</span> <span class="n">letter</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="n">format</span><span class="o">(</span><span class="s">"%s is not a Cailloux"</span><span class="o">,</span> <span class="n">name</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kt">var</span> <span class="n">dayOfYear</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
    <span class="k">if</span><span class="o">(</span><span class="n">dayOfYear</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">dayOfYear</span> <span class="o">&gt;</span> <span class="mi">365</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="n">format</span><span class="o">(</span><span class="s">"%s is not a Cailloux"</span><span class="o">,</span> <span class="n">name</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nf">Caillou</span><span class="o">(</span><span class="n">letter</span><span class="o">,</span> <span class="n">dayOfYear</span><span class="o">);</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">handleCreate</span><span class="o">(</span><span class="nc">String</span> <span class="n">input</span><span class="o">){</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">create</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
        <span class="n">doSomethingWithCaillou</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
    <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">error</span><span class="o">){</span>
    <span class="n">log</span><span class="o">(</span><span class="n">error</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>(L’ancien code.)</p>

<p>Ces imbrications nous privent de précieuses performances. Une des solutions à ce problème c’est l’ADT Result. 
Malheureusement pour Henri en Java 17 il n’existe pas d’implémentation de Result. Cependant il y a eu une grande avancée permettant de créer ce genre de typage :</p>
<ul>
  <li>Les interfaces scellées</li>
  <li>Les records</li>
  <li>Le switch-pattern-matching
Voici comment on pourrait représenter le Result en Java 17</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sealed</span> <span class="kd">interface</span> <span class="nc">Result</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span><span class="no">E</span><span class="o">&gt;</span> <span class="n">permits</span> <span class="nc">Result</span><span class="o">.</span><span class="na">Ok</span><span class="o">,</span> <span class="nc">Result</span><span class="o">.</span><span class="na">Err</span> <span class="o">{</span>
    <span class="n">record</span> <span class="nc">Ok</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span><span class="no">E</span><span class="o">&gt;(</span><span class="no">T</span> <span class="n">ok</span><span class="o">)</span> <span class="kd">implements</span> <span class="nc">Result</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span><span class="no">E</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="nc">Ok</span> <span class="o">{</span>
            <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">ok</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span> 
    <span class="n">record</span> <span class="nc">Err</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span><span class="no">E</span><span class="o">&gt;(</span><span class="no">E</span> <span class="n">error</span><span class="o">)</span> <span class="kd">implements</span> <span class="nc">Result</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span><span class="no">E</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="nc">Err</span> <span class="o">{</span>
            <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">error</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">Ok</span> <span class="nf">ok</span><span class="o">(</span><span class="no">T</span> <span class="n">ok</span><span class="o">){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Ok</span><span class="o">(</span><span class="n">ok</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="nc">Err</span> <span class="nf">err</span><span class="o">(</span><span class="no">E</span> <span class="n">error</span><span class="o">){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Err</span><span class="o">(</span><span class="n">error</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>(source: <a href="https://oteku.github.io/">Thomas Haesslé</a>)</p>

<p>Voici comment Henri l’utilise aujourd’hui</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="nc">Result</span><span class="o">&lt;</span><span class="nc">Caillou</span><span class="o">,</span> <span class="nc">Exception</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">){</span>
    <span class="kt">var</span> <span class="n">letter</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="k">if</span><span class="o">(</span><span class="n">letter</span> <span class="o">&lt;</span> <span class="mi">65</span> <span class="o">||</span> <span class="n">letter</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Result</span><span class="o">.</span><span class="na">err</span><span class="o">(</span><span class="k">new</span> <span class="nc">IllegalArgumentException</span><span class="o">(</span><span class="n">format</span><span class="o">(</span><span class="s">"%s is not a Cailloux"</span><span class="o">,</span> <span class="n">name</span><span class="o">)));</span>
    <span class="o">}</span>

    <span class="kt">var</span> <span class="n">dayOfYear</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
    <span class="k">if</span><span class="o">(</span><span class="n">dayOfYear</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">dayOfYear</span> <span class="o">&gt;</span> <span class="mi">365</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Result</span><span class="o">.</span><span class="na">err</span><span class="o">(</span><span class="k">new</span> <span class="nc">IllegalArgumentException</span><span class="o">(</span><span class="n">format</span><span class="o">(</span><span class="s">"%s is not a Cailloux"</span><span class="o">,</span> <span class="n">name</span><span class="o">)));</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="nc">Result</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="k">new</span> <span class="nc">Caillou</span><span class="o">(</span><span class="n">letter</span><span class="o">,</span> <span class="n">dayOfYear</span><span class="o">));</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">handleCreate</span><span class="o">(</span><span class="nc">String</span> <span class="n">input</span><span class="o">){</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">create</span><span class="o">(</span><span class="n">input</span><span class="o">)){</span>
        <span class="k">case</span> <span class="nc">Result</span><span class="o">.</span><span class="na">Err</span><span class="o">&lt;</span><span class="nc">Caillou</span><span class="o">,</span> <span class="nc">Exception</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">-&gt;</span> <span class="n">log</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">error</span><span class="o">);</span>
        <span class="k">case</span> <span class="nc">Result</span><span class="o">.</span><span class="na">Ok</span><span class="o">&lt;</span><span class="nc">Caillou</span><span class="o">,</span> <span class="nc">Exception</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">-&gt;</span> <span class="n">doSomethingWithCaillou</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">ok</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>(Le nouveau code)</p>

<p><img src="/articles/common/abstract-data-types//henry_5.png" alt="image" /> <br /></p>

<p>Maintenant Henri est heureux, il propose pour conclure quelques cartes pour mémoriser certains ADT et leurs particularités.</p>

<p>Sources</p>
<ul>
  <li><a href="https://en.wikipedia.org/wiki/Tagged_union">https://en.wikipedia.org/wiki/Tagged_union</a></li>
  <li><a href="https://fr.wikipedia.org/wiki/Structure_de_donn%C3%A9es">https://fr.wikipedia.org/wiki/Structure_de_donn%C3%A9es</a></li>
  <li><a href="https://fr.wikipedia.org/wiki/Type_abstrait">https://fr.wikipedia.org/wiki/Type_abstrait</a></li>
  <li><a href="https://dev.realworldocaml.org/variants.html">https://dev.realworldocaml.org/variants.html</a></li>
  <li><a href="https://jpintelli.com/2020/12/28/adt-with-java-sealed-classes-pattern-matching-records/">https://jpintelli.com/2020/12/28/adt-with-java-sealed-classes-pattern-matching-records/</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Record_(computer_science)">https://en.wikipedia.org/wiki/Record_(computer_science)</a></li>
  <li><a href="https://fr.wikipedia.org/wiki/Type_r%C3%A9cursif">https://fr.wikipedia.org/wiki/Type_r%C3%A9cursif</a></li>
  <li><a href="https://blog.shangjiaming.com/vavr-introduction/">https://blog.shangjiaming.com/vavr-introduction/</a></li>
  <li><a href="https://www.vavr.io/">https://www.vavr.io/</a></li>
  <li><a href="https://v2.ocaml.org/manual/gadts-tutorial.html">https://v2.ocaml.org/manual/gadts-tutorial.html</a></li>
  <li><a href="https://cs.wellesley.edu/~cs251/s12/handouts/modules.pdf">https://cs.wellesley.edu/~cs251/s12/handouts/modules.pdf</a></li>
  <li><a href="https://medium.com/@aoturan/commonly-used-abstract-data-types-d9470b14f864">https://medium.com/@aoturan/commonly-used-abstract-data-types-d9470b14f864</a></li>
</ul>
</span>
      </div>
    </article>
  </div>

            <footer class="footer">
    <div class="footer-content">
        <h4>Qui sommes nous :</h4>
        <p>"Nos experts vous accompagnent sur la réalisation et l’amélioration de vos systèmes d’information tout en étant en immersion dans vos équipes."</p>
    </div>
    <div class="footer-content">
        <h4>La plus-value proposée :</h4>
        <p>
            vous permettre de prendre du recul sur l’utilisation technologique afin qu’elle soit adaptée à votre contexte.
        </p>
    </div>
    <div class="footer-content">
        <h4>Nous suivre :</h4>
        <div class="social">
            <a href="https://www.linkedin.com/company/ekite/" target="_blank"><img alt="linkedin" src="/assets/images/logo-linkedin.png"></a>
            <a href="https://twitter.com/Ekite_" target="_blank"><img alt="Twitter" src="/assets/images/logo-twitter.png"></a>
            <a href="https://github.com/ekit3" target="_blank"><img alt="Github" src="/assets/images/logo-github.png"></a>
        </div>
    </div>
</footer>
 <div class="copyright">
    <span>Ekite © Copyright 2021. Tous droits réservés</span>
    <a href="/mentions">Mentions légales</a>
    <a href="https://github.com/Ekawa-fr" target="_blank">Réalisé par Ekawa</a>
</div>

        </main>
        <script src="/assets/libs/jquery-3.5.1.min.js"></script>
        <script src="/scripts/index.js"></script>
        <script src="/assets/libs/bootstrap.bundle.min.js"></script>
        <script src="/assets/libs/select2.full.min.js"></script>
        <script>
            if (window.Worker) {
                navigator.serviceWorker.register('/worker.js').then(function(registration) {
                    // console.log('ServiceWorker registration successful with scope:',  registration.scope);
                }).catch(function(error) {
                    console.warn('ServiceWorker registration failed:', error);
                });
            }
        </script>
    </body>
</html>
